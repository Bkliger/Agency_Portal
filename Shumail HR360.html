{% fetchxml myquery %}
<fetch mapping="logical">
  <entity name="cr9aa_hr360">
    <all-attributes />​
      <filter type='and'>
        <condition attribute='cr9aa_startyear' operator='eq' value="{{request.params['startyear']}}" />
        <condition attribute='cr9aa_endyear' operator='eq' value="{{request.params['endyear']}}" />
        <condition attribute='cr9aa_startmonth' operator='eq' value="{{request.params['startmonth']}}" />
        <condition attribute='cr9aa_endmonth' operator='eq' value="{{request.params['endmonth']}}" />
      </filter>
  </entity>
</fetch>
{% endfetchxml %}
{% assign recordCount=myquery.results.entities.size %}
<div class="container">
<div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
  <h3 class="my-0 mr-md-auto">{{user.fullname}}</h3>
  <!--<a class="btn btn-outline-primary" href="#">Sign up</a>-->
</div>

<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Statistics</a>

  </li>
  <li class="nav-item">
    <a class="nav-link" id="narrative-tab" data-toggle="tab" href="#narrative" role="tab" aria-controls="narrative" aria-selected="false">Narrative</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Budget</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Attachments</a>
  </li>
</ul>
<div class="tab-content" id="myTabContent">
  <div class="tab-pane fade in active" id="home" role="tabpanel" aria-labelledby="home-tab">
    <br>
    <div class="container">
      <div class="row">

        <div class="col text-left">
          <h2>Quarterly Data Entry (Statistics)</h2>
        </div>


        <!-- Popup with a button -->
        <div class="col-xs-12 text-right margin">
          <!-- Button trigger modal -->
          <button type="button" class="btn btn-primary" id="save">
            Save </button>
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
            Close </button>
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
            Submit </button>
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
            Print </button>


        </div>
      </div>
    </div>

    <!-- TOTAL Referrals -->
    <div class="container">
      <div class="row">
        <div class="col">
          <div class="row">
            <div class="col heading-border">
              <h4>Referrals</h4>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># referrals, total</p>
            </div>
            <div class="col">
              <input class="form-control" id="cr9aa_numreferralstotal" type="text" value="{% if recordCount > 0 %}{{myquery.results.entities[0].cr9aa_numreferralstotal}} {% endif %}">
          </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># non AB 109 referrals</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># referrals from probation</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># referrals from CCCOE</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># completed ISPs</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Demographic characteristics of new enrollees -->

    <div class="container">
      <div class="row">
        <div class="col">
          <div class="row">
            <div class="col heading-border">
              <h4>Demographic characteristics of new participants</h4>
              </h4>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"><b>Race & Ethnicity</b></p>
            </div>
          </div>


          <div class="row">
            <div class="col">
              <p class="popup-txt">Asian</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Black</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Hispanic</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Native American</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">White</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Other</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"><b>Age</b></p>
            </div>
          </div>


          <div class="row">
            <div class="col">
              <p class="popup-txt">Aged ≤ 25</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Aged 26-35</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Aged 36-45</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Aged 46-55</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Aged > 55</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Unknown</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"><b>Sex</b></p>
            </div>
          </div>


          <div class="row">
            <div class="col">
              <p class="popup-txt">Men</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Women</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"><b>Region</b></p>
            </div>
          </div>


          <div class="row">
            <div class="col">
              <p class="popup-txt">West</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Central</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">East</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"><b>Tier</b></p>
            </div>
          </div>


          <div class="row">
            <div class="col">
              <p class="popup-txt">AB 109 Probation</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Felony Probation </p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">≥ 30 days in custody, released w/in last 3 yrs.</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Currently awaiting trial</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Currently on court probation</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Special court probation (Behavioral, DV, drug)</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Currently on Parole</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Currently in custody</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">Out of jurisdiction</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">None of the above</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>
        </div>
      </div>
    </div>



    <!-- Goals completed by women: -->
    <div class="container">
      <div class="row">
        <div class="col">
          <div class="row">
            <div class="col heading-border">
              <h4>Goals completed by women:</h4>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># completed a transition plan</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># completed transition plan while incarcerated</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># received case management upon release</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>


          <div class="row">
            <div class="col">
              <p class="popup-txt"># completed at least 1 goal</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># completed at least 2 goals</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># completed at least 3 goals</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># matched to a mentor-navigator</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>
        </div>

        <div class="col">

          <!-- Services for men: -->

          <div class="row">
            <div class="col heading-border">
              <h4>Services for men:</h4>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># received needs screening while incarcerated</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># received reentry plan while incarcerated</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># matched to a mentor-navigator</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>
        </div>
      </div>
    </div>



    <!-- Program Outcomes: -->
    <div class="container">
      <div class="row">
        <div class="col">
          <div class="row">
            <div class="col heading-border">
              <h4>Program Outcomes:</h4>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># successfully completed program</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># unsuccessfully completed program</p>
            </div>
            <div class="col">
              <input class="form-control" type="text">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># of newsletters produced</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>


          <div class="row">
            <div class="col">
              <p class="popup-txt"># completed at least 1 goal</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>
        </div>


        <div class="col">

          <!-- Mentor-Navigators: -->

          <div class="row">
            <div class="col heading-border">
              <h4>Mentor-Navigators:</h4>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt"># of mentor-navigators trained</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <p class="popup-txt">average number of mentees/mentor</p>
            </div>
            <div class="col">
              <input class="form-control" type="number">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="tab-pane fade" id="narrative" role="tabpanel" aria-labelledby="narrative-tab">




    <div class="container">
      <div class="row">

        <div class="col text-left">
          <h2>Quarterly Data Entry (Narrative)</h2>
        </div>


        <div class="col text-right">
          <button type="button" class="btn btn-primary">Save</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>

      </div>
    </div>

    <form>
      <div class="container">


        <div class="row">
          <div class="col">
            <p class="popup-txt">Fiscal Year</p>
          </div>
          <div class="col">
            <p class="popup-txt">2020-21</p>
          </div>

        </div>

        <div class="row">
          <div class="col">
            <p class="popup-txt">Quarter</p>
          </div>
          <div class="col">
            <p class="popup-txt">Jan-Mar</p>
          </div>

        </div>

        <div class="row">
          <div class="col">
            <p class="popup-txt">Section One: Performance and
              Demographic Data Measures</p>
          </div>
          <div class="col form-group">
            <textarea class="form-control" rows="3"></textarea>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <p class="popup-txt">Section two: Budget Expenditures</p>
          </div>
          <div class="col form-group">
            <textarea class="form-control" rows="3"></textarea>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <p class="popup-txt">Section Three: Section Four: Concerns/Changes with Organiztional Context or Partners</p>
          </div>
          <div class="col form-group">
            <textarea class="form-control" rows="3"></textarea>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <p class="popup-txt">Section Four: Programmatic Outcomes, Lessons Learned</p>
          </div>
          <div class="col form-group">
            <textarea class="form-control" rows="3"></textarea>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <p class="popup-txt">Section Five: Next Steps</p>
          </div>
          <div class="col form-group">
            <textarea class="form-control" rows="3"></textarea>
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">tab3</div>
</div>
</div>
<div class="empty-space">
</div>

<script>
$(document).on('click','#save',function(){
  var cr9aa_numreferralstotal=$("#cr9aa_numreferralstotal").val();
	webapi.safeAjax({
		type: "POST",
		url: "/_api/cr9aa_hr360s",
		contentType: "application/json",
		data: JSON.stringify({
			"cr9aa_startyear": "{{request.params['startyear']}}",
      "cr9aa_endyear": "{{request.params['endyear']}}",
      "cr9aa_startmonth": "{{request.params['startmonth']}}",
      "cr9aa_endmonth": "{{request.params['endmonth']}}",
      "cr9aa_numreferralstotal": Number(cr9aa_numreferralstotal)

		}),
		success: function (res, status, xhr) {
      //print id of newly created entity record
			console.log("entityID: "+ xhr.getResponseHeader("entityid"))
		}
	});



});

</script>
